<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spotify Artists Info</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
  </head>
  <body class="container mt-5">
    <h1 class="h1 text-success">Spotify Artists Info</h1>
    <div class="p-2 mt-3">
      <div class="input-group mb-3">
        <span class="input-group-text">Access token</span>
        <input
          class="form-control"
          type="text"
          id="token"
          placeholder="Bearer token here"
        />
        <input
          class="form-control bg-success-subtle"
          type="text"
          id="artist-search"
          placeholder="Buscar artista (ej: Coldplay, Bad Bunny)"
        />
        <button class="btn btn-success" id="fetch-btn">Get Artist Info</button>
      </div>
    </div>

    <section id="artist-info"></section>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>
      // Seleccionar elementos del HTML para usarlos en el script
      var token = document.getElementById('token');
      var artistSearch = document.getElementById('artist-search');
      var boton = document.getElementById('fetch-btn');
      var info = document.getElementById('artist-info');

      // Función para buscar artista, hace la petición a la API de Spotify y muestra la información del artista
      function buscarArtista() {
        var miToken = token.value;
        var nombreArtista = artistSearch.value;

        if (miToken === '') {
          alert('Por favor ingresa un token');
          return;
        }

        if (nombreArtista === '') {
          alert('Por favor ingresa el nombre de un artista');
          return;
        }

        // Un indicador de carga para que el usuario sepa que se está procesando
        info.innerHTML = '<div class="text-center"><div class="spinner-border text-success"></div></div>';

        // Petición de busqueda del nombre del artista
        fetch('https://api.spotify.com/v1/search?q=' + nombreArtista + '&type=artist&limit=1', {
          headers: {
            'Authorization': 'Bearer ' + miToken
          }
        })
        .then(function(respuesta) {
          return respuesta.json();
        })
        .then(function(datos) {
          var artistas = datos.artists.items;
          
          if (artistas.length === 0) {
            info.innerHTML = '<div class="alert alert-info">No se encontró el artista</div>';
            return;
          }
          
          var artista = artistas[0];
          mostrarArtista(artista);
        })
        .catch(function(error) {
          info.innerHTML = '<div class="alert alert-danger">Error al cargar. Verifica tu token.</div>';
        });
      }

      // Función que prepara y muestra la información del artista
      function mostrarArtista(artista) {
        var imagen = 'https://via.placeholder.com/300';
        if (artista.images.length > 0) {
          imagen = artista.images[0].url;
        }

        var seguidores = artista.followers.total.toLocaleString('es-MX');

        var generos = '';
        if (artista.genres.length > 0) {
          for (var i = 0; i < artista.genres.length; i++) {
            generos += '<span class="badge bg-success me-1">' + artista.genres[i] + '</span>';
          }
        } else {
          generos = '<span class="text-muted">No especificado</span>';
        }

        info.innerHTML = 
          '<div class="card">' +
            '<img src="' + imagen + '" class="card-img-top" alt="' + artista.name + '">' +
            '<div class="card-body">' +
              '<h3 class="card-title">' + artista.name + '</h3>' +
              '<p><strong>Seguidores:</strong> ' + seguidores + '</p>' +
              '<p><strong>Popularidad:</strong> ' + artista.popularity + '/100</p>' +
              '<div class="progress mb-3" style="height: 25px;">' +
                '<div class="progress-bar bg-success" style="width: ' + artista.popularity + '%">' +
                  artista.popularity + '%' +
                '</div>' +
              '</div>' +
              '<p><strong>Géneros:</strong><br>' + generos + '</p>' +
              '<a href="' + artista.external_urls.spotify + '" target="_blank" class="btn btn-success">' +
                'Abrir en Spotify' +
              '</a>' +
            '</div>' +
          '</div>';
      }

      // Activar función al hacer clic
      boton.addEventListener('click', buscarArtista);

      // Permitir buscar con Enter
      artistSearch.addEventListener('keypress', function(evento) {
        if (evento.key === 'Enter') {
          buscarArtista();
        }
      });

      token.addEventListener('keypress', function(evento) {
        if (evento.key === 'Enter') {
          buscarArtista();
        }
      });
    </script>
  </body>
</html>